<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Animals Watchlist</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body { 
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 20px;
}

.container { max-width: 900px; margin: 0 auto; }

h1 { text-align: center; color: white; font-size: 2.5em; margin-bottom: 30px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }

.auth-wrapper { display: flex; gap: 20px; flex-wrap: wrap; }

#register-section, #login-section {
  flex: 1; min-width: 280px;
  background: white; padding: 30px;
  border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

#register-section h2 { color: #667eea; margin-bottom: 20px; font-size: 1.8em; }
#login-section h2 { color: #764ba2; margin-bottom: 20px; font-size: 1.8em; }

#pets-section { background: white; padding: 30px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
#pets-section > h2 { color: #333; margin-bottom: 20px; font-size: 1.8em; text-align: center; }

.section { margin: 20px 0; padding: 25px; border-radius: 12px; border: 2px solid transparent; transition: all 0.3s ease; }

#add-pet-section { background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); border-color: #00acc1; }
#my-pets-section { background: linear-gradient(135deg, #f1f8e9 0%, #dcedc8 100%); border-color: #7cb342; }

h3 { color: #333; margin-bottom: 15px; font-size: 1.4em; display: flex; align-items: center; gap: 10px; }
#add-pet-section h3::before { content: "üê∂"; font-size: 1.2em; }
#my-pets-section h3::before { content: "üêæ"; font-size: 1.2em; }

input {
  width: 100%; padding: 12px 15px; margin-bottom: 12px;
  border-radius: 8px; border: 2px solid #e0e0e0; font-size: 14px; transition: border-color 0.3s ease;
}
input:focus { outline: none; border-color: #667eea; }
input::placeholder { color: #999; }

button {
  padding: 12px 24px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600;
  cursor: pointer; transition: all 0.3s ease; margin-right: 8px; margin-top: 5px;
}
#register-section button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; width: 100%; }
#login-section button { background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); color: white; width: 100%; }
#add-pet-section button { background: #00acc1; color: white; }
#my-pets-section > button { background: #7cb342; color: white; }

ul { list-style: none; padding: 0; }
li { background: white; padding: 15px; margin-bottom: 12px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; transition: transform 0.2s ease; }
li:hover { transform: translateX(5px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
.error { color: #f44336; text-align: center; margin-top: 10px; font-weight: 500; }
.success { color: #4caf50; text-align: center; margin-top: 10px; font-weight: 500; }
.hidden { display: none; }
</style>
</head>
<body>
<h1>Animals Watchlist üêæ</h1>

<div class="auth-wrapper">
  <div id="register-section">
    <h2>Register</h2>
    <input type="text" id="register-username" placeholder="Choose a username">
    <input type="password" id="register-password" placeholder="Choose a password">
    <button onclick="register()">Create Account</button>
    <p id="register-message" class="error"></p>
  </div>

  <div id="login-section">
    <h2>Login</h2>
    <input type="text" id="login-username" placeholder="Enter username">
    <input type="password" id="login-password" placeholder="Enter password">
    <button onclick="login()">Sign In</button>
    <p id="login-message" class="error"></p>
  </div>
</div>

<div id="pets-section" class="hidden">
  <h2>Welcome, <span id="username"></span>! üêæ</h2>
  <button onclick="logout()">Logout</button>

  <div id="add-pet-section" class="section">
    <h3>Add New Pet</h3>
    <input type="text" id="pet-name" placeholder="Pet name">
    <input type="text" id="pet-type" placeholder="Pet type (Dog, Cat...)">
    <input type="number" id="pet-age" placeholder="Age">
    <button onclick="addPet()">Add Pet</button>
    <p id="pets-message"></p>
  </div>

  <div id="my-pets-section" class="section">
    <h3>My Pets</h3>
    <button onclick="showMyPets()">Refresh List</button>
    <ul id="pets-list"></ul>
  </div>
</div>

<script>
let username = null;

const API_BASE_URL = window.location.origin;

// ----------------- AUTH -----------------
async function register(){
  const usernameVal = document.getElementById('register-username').value.trim();
  const password = document.getElementById('register-password').value.trim();
  const messageEl = document.getElementById('register-message');
  messageEl.textContent='';

  if(!usernameVal || !password){ messageEl.textContent='Enter username and password'; return; }

  try{
    const res = await fetch(`${API_BASE_URL}/api/register`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({username:usernameVal,password})
    });
    const data = await res.json();
    if(res.ok){ messageEl.className='success'; messageEl.textContent='Registered! Please login.'; }
    else { messageEl.className='error'; messageEl.textContent=data.error || 'Registration failed'; }
  } catch(e){ messageEl.className='error'; messageEl.textContent='Server connection error'; }
}

async function login(){
  const usernameVal = document.getElementById('login-username').value.trim();
  const password = document.getElementById('login-password').value.trim();
  const messageEl = document.getElementById('login-message');
  messageEl.textContent='';

  try{
    const res = await fetch(`${API_BASE_URL}/api/login`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({username:usernameVal,password})
    });
    const data = await res.json();
    if(res.ok){
      username = data.username;
      document.getElementById('username').textContent=username;
      document.querySelector('.auth-wrapper').style.display='none';
      document.getElementById('pets-section').classList.remove('hidden');
      showMyPets();
    } else { messageEl.className='error'; messageEl.textContent=data.error || 'Login failed'; }
  } catch(e){ messageEl.className='error'; messageEl.textContent='Server connection error'; }
}

// ----------------- PETS -----------------
async function addPet(){
  const name = document.getElementById('pet-name').value.trim();
  const type_ = document.getElementById('pet-type').value.trim();
  const age = parseInt(document.getElementById('pet-age').value);
  const messageEl = document.getElementById('pets-message');
  messageEl.textContent='';

  if(!name){ messageEl.className='error'; messageEl.textContent='Enter pet name'; return; }

  try{
    const res = await fetch(`${API_BASE_URL}/pets`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({username,name,type:type_,age})
    });
    const data = await res.json();
    if(res.ok){ messageEl.className='success'; messageEl.textContent=`Pet '${name}' added!`; 
      document.getElementById('pet-name').value=''; document.getElementById('pet-type').value=''; document.getElementById('pet-age').value=''; 
      showMyPets(); 
    } else { messageEl.className='error'; messageEl.textContent=data.error || 'Failed to add pet'; }
  } catch(e){ messageEl.className='error'; messageEl.textContent='Server connection error'; }
}

async function showMyPets(){
  const listEl = document.getElementById('pets-list');
  listEl.innerHTML='';
  try{
    const res = await fetch(`${API_BASE_URL}/pets/${username}`);
    const data = await res.json();
    if(res.ok){
      if(data.pets.length===0){ listEl.innerHTML='<li style="text-align:center; color:#999;">No pets yet!</li>'; }
      else{
        data.pets.forEach(p=>{
          const li=document.createElement('li');
          li.innerHTML=`<span>${p.name} (${p.type}) - Age: ${p.age}</span>`;
          const delBtn=document.createElement('button');
          delBtn.textContent='Delete';
          delBtn.onclick=()=>deletePet(p._id);
          li.appendChild(delBtn);
          listEl.appendChild(li);
        });
      }
    } else { listEl.innerHTML='<li style="color:red;">Failed to fetch pets</li>'; }
  } catch(e){ listEl.innerHTML='<li style="color:red;">Server connection error</li>'; }
}

async function deletePet(id){
  if(!confirm('Are you sure you want to delete this pet?')) return;
  try{
    const res = await fetch(`${API_BASE_URL}/pets/${id}`,{ method:'DELETE' });
    if(res.ok){ showMyPets(); } 
    else { alert('Failed to delete pet'); }
  } catch(e){ alert('Server connection error'); }
}

// ----------------- LOGOUT -----------------
function logout(){
  username=null;
  document.querySelector('.auth-wrapper').style.display='flex';
  document.getElementById('pets-section').classList.add('hidden');
  document.getElementById('login-username').value=''; document.getElementById('login-password').value='';
}
</script>
</body>
</html>
